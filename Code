--[[
    BSS AUTO FARM â€“ PURPLE & BLACK THEME (No Emojis)
    â€¢ FULLY ORGANIZED UI â€¢ PERFECT ALIGNMENT â€¢ CLEAN DESIGN
    â€¢ ANTI-AFK SYSTEM AUTOMATICALLY ACTIVE
    â€¢ AUTO-RESPAWN & AUTO-CONVERT
--]]

local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CoreGui = game:GetService("CoreGui")
local VirtualInputManager = game:GetService("VirtualInputManager")
local TweenService = game:GetService("TweenService")

local Player = Players.LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()
local HRP = Character:WaitForChild("HumanoidRootPart")
local Humanoid = Character:WaitForChild("Humanoid")

-- Events
local toolCollect = ReplicatedStorage.Events.ToolCollect
local claimHive = ReplicatedStorage.Events.ClaimHive
local playerHiveCmd = ReplicatedStorage.Events.PlayerHiveCommand
local Hives = Workspace:WaitForChild("Honeycombs")
local coreStats = Player:WaitForChild("CoreStats")

-- Variables
local flowerFields = {}
for _, v in pairs(Workspace.FlowerZones:GetChildren()) do
    table.insert(flowerFields, v.Name)
end

local autofarmField = flowerFields[1] or "Sunflower Field"
local autofarmVar = false
local autoTool = false
local autoFarmRadius = 30
local playerHive = nil
local currentField = nil

-- Anti-AFK Variables
local afkConnection = nil

-- Anti-AFK Function (Automatically Enabled)
local function enableAntiAFK()
    if afkConnection then
        afkConnection:Disconnect()
        afkConnection = nil
    end
    
    afkConnection = game:GetService("Players").LocalPlayer.Idled:Connect(function()
        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Space, false, game)
        task.wait(0.1)
        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Space, false, game)
    end)
end

-- Enable Anti-AFK automatically when script starts
enableAntiAFK()

-- Get Hive
local function getPlayerHive()
    for _, Hive in pairs(Hives:GetChildren()) do
        if tostring(Hive.Owner.Value) == tostring(Player.Name) then
            return Hive
        end
    end
    for _, Hive in pairs(Hives:GetChildren()) do
        if Hive.Owner.Value == nil then
            HRP.CFrame = Hive.SpawnPos.Value + Vector3.new(0,3,0)
            task.wait(1)
            claimHive:FireServer(Hive.HiveID.Value)
            break
        end
    end
    task.wait(2)
    return getPlayerHive()
end
playerHive = getPlayerHive()

-- Utils
local function randomPoint(radius, cf)
    local p = cf.Position
    local x = math.random(p.X - radius, p.X + radius)
    local z = math.random(p.Z - radius, p.Z + radius)
    return Vector3.new(x, p.Y, z)
end

local function convert()
    if coreStats.Pollen.Value == 0 then return end
    local currentPos = HRP.Position
    HRP.CFrame = playerHive.SpawnPos.Value + Vector3.new(0,3,0)
    task.wait(1)
    playerHiveCmd:FireServer("ToggleHoneyMaking")
    local t = 0
    repeat task.wait(1) t = t + 1 until coreStats.Pollen.Value == 0 or t > 60
    task.wait(6)
    if currentField then
        HRP.CFrame = currentField.CFrame + Vector3.new(0,5,0)
    end
end

-- Auto respawn handler
local function onCharacterAdded(newCharacter)
    Character = newCharacter
    HRP = Character:WaitForChild("HumanoidRootPart")
    Humanoid = Character:WaitForChild("Humanoid")
    task.wait(3)
    if autofarmVar and currentField then
        HRP.CFrame = currentField.CFrame + Vector3.new(0,5,0)
    end
end

Player.CharacterAdded:Connect(onCharacterAdded)

local function farm()
    autofarmVar = true
    autoTool = true
    local field = Workspace.FlowerZones:FindFirstChild(autofarmField)
    if not field then return end
    
    currentField = field
    
    while autofarmVar do
        HRP.CFrame = field.CFrame + Vector3.new(0,5,0)
        task.wait(0.2)
        
        local cap = coreStats.Capacity.Value
        
        repeat
            local pos = randomPoint(autoFarmRadius, field.CFrame)
            Humanoid:MoveTo(pos)
            local waitTime = 0
            repeat 
                task.wait() 
                waitTime = waitTime + 0.1
                if coreStats.Pollen.Value >= cap then
                    break
                end
            until (HRP.Position - pos).Magnitude < 5 or waitTime > 10
            
            if coreStats.Pollen.Value >= cap then
                convert()
                HRP.CFrame = field.CFrame + Vector3.new(0,5,0)
                task.wait(0.2)
            end
            
        until coreStats.Pollen.Value >= cap or not autofarmVar
        
        if coreStats.Pollen.Value >= cap then
            convert()
        end
    end
end

-- Auto Tool
task.spawn(function()
    while true do
        if autoTool then
            pcall(function() toolCollect:FireServer() end)
        end
        task.wait()
    end
end)

-- =====================================================
-- FULLY ORGANIZED UI SYSTEM
-- =====================================================

local sg = Instance.new("ScreenGui")
sg.Name = "BSSAutoFarmUI"
sg.ResetOnSpawn = false
sg.Parent = CoreGui

-- MAIN CONTROL PANEL (Centered)
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainControlPanel"
mainFrame.Size = UDim2.new(0, 400, 0, 250) -- Adjusted size to fit content
mainFrame.Position = UDim2.new(0.5, -200, 0.5, -125)
mainFrame.BackgroundColor3 = Color3.fromRGB(20, 15, 25)
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = sg

local mainUc = Instance.new("UICorner")
mainUc.CornerRadius = UDim.new(0, 12)
mainUc.Parent = mainFrame

local mainUs = Instance.new("UIStroke")
mainUs.Color = Color3.fromRGB(100, 60, 140)
mainUs.Thickness = 2
mainUs.Parent = mainFrame

-- HEADER SECTION
local headerFrame = Instance.new("Frame")
headerFrame.Name = "Header"
headerFrame.Size = UDim2.new(1, 0, 0, 50)
headerFrame.Position = UDim2.new(0, 0, 0, 0)
headerFrame.BackgroundTransparency = 1
headerFrame.Parent = mainFrame

local titleLabel = Instance.new("TextLabel")
titleLabel.Name = "Title"
titleLabel.Size = UDim2.new(1, -10, 0, 25)
titleLabel.Position = UDim2.new(0, 5, 0, 5)
titleLabel.BackgroundTransparency = 1
titleLabel.Font = Enum.Font.GothamBlack
titleLabel.Text = "BSS AUTO FARM"
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.TextSize = 20
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.Parent = headerFrame

local subtitleLabel = Instance.new("TextLabel")
subtitleLabel.Name = "Subtitle"
subtitleLabel.Size = UDim2.new(1, -10, 0, 20)
subtitleLabel.Position = UDim2.new(0, 5, 0, 25)
subtitleLabel.BackgroundTransparency = 1
subtitleLabel.Font = Enum.Font.GothamMedium
subtitleLabel.Text = "https://www.youtube.com/@HerDarkiee"
subtitleLabel.TextColor3 = Color3.fromRGB(180, 150, 220)
subtitleLabel.TextSize = 12
subtitleLabel.TextXAlignment = Enum.TextXAlignment.Left
subtitleLabel.Parent = headerFrame

-- STATUS INDICATOR (Top Right)
local statusFrame = Instance.new("Frame")
statusFrame.Name = "StatusFrame"
statusFrame.Size = UDim2.new(0, 100, 0, 30)
statusFrame.Position = UDim2.new(1, -110, 0, 10)
statusFrame.BackgroundColor3 = Color3.fromRGB(25, 20, 35)
statusFrame.Parent = headerFrame

local statusUc = Instance.new("UICorner")
statusUc.CornerRadius = UDim.new(0, 6)
statusUc.Parent = statusFrame

local statusUs = Instance.new("UIStroke")
statusUs.Color = Color3.fromRGB(120, 80, 160)
statusUs.Thickness = 1
statusUs.Parent = statusFrame

local statusValue = Instance.new("TextLabel")
statusValue.Name = "StatusValue"
statusValue.Size = UDim2.new(1, -5, 1, 0)
statusValue.Position = UDim2.new(0, 5, 0, 0)
statusValue.BackgroundTransparency = 1
statusValue.Font = Enum.Font.GothamBold
statusValue.Text = "Ready"
statusValue.TextColor3 = Color3.fromRGB(180, 150, 220)
statusValue.TextSize = 12
statusValue.Parent = statusFrame

-- CONTROL SECTION (Left Column)
local leftColumn = Instance.new("Frame")
leftColumn.Name = "LeftColumn"
leftColumn.Size = UDim2.new(0.48, 0, 0, 150)
leftColumn.Position = UDim2.new(0.02, 0, 0, 60)
leftColumn.BackgroundTransparency = 1
leftColumn.Parent = mainFrame

-- FIELD SELECTION
local fieldSection = Instance.new("Frame")
fieldSection.Name = "FieldSection"
fieldSection.Size = UDim2.new(1, 0, 0, 150)
fieldSection.Position = UDim2.new(0, 0, 0, 0)
fieldSection.BackgroundTransparency = 1
fieldSection.Parent = leftColumn

local fieldLabel = Instance.new("TextLabel")
fieldLabel.Name = "FieldLabel"
fieldLabel.Size = UDim2.new(1, 0, 0, 25)
fieldLabel.BackgroundTransparency = 1
fieldLabel.Font = Enum.Font.GothamSemibold
fieldLabel.Text = "SELECT FIELD"
fieldLabel.TextColor3 = Color3.fromRGB(200, 180, 230)
fieldLabel.TextSize = 14
fieldLabel.TextXAlignment = Enum.TextXAlignment.Left
fieldLabel.Parent = fieldSection

local dropBtn = Instance.new("TextButton")
dropBtn.Name = "DropBtn"
dropBtn.Size = UDim2.new(1, 0, 0, 40)
dropBtn.Position = UDim2.new(0, 0, 0, 30)
dropBtn.BackgroundColor3 = Color3.fromRGB(30, 25, 40)
dropBtn.AutoButtonColor = false
dropBtn.Font = Enum.Font.GothamMedium
dropBtn.Text = autofarmField
dropBtn.TextColor3 = Color3.fromRGB(240, 240, 240)
dropBtn.TextSize = 14
dropBtn.TextXAlignment = Enum.TextXAlignment.Left
dropBtn.Parent = fieldSection

local dropUc = Instance.new("UICorner")
dropUc.CornerRadius = UDim.new(0, 8)
dropUc.Parent = dropBtn

local dropUs = Instance.new("UIStroke")
dropUs.Color = Color3.fromRGB(120, 80, 160)
dropUs.Thickness = 1
dropUs.Parent = dropBtn

local arrow = Instance.new("TextLabel")
arrow.Name = "Arrow"
arrow.Size = UDim2.new(0, 20, 0, 20)
arrow.Position = UDim2.new(1, -25, 0.5, -10)
arrow.BackgroundTransparency = 1
arrow.Font = Enum.Font.GothamBold
arrow.Text = "â–¼"
arrow.TextColor3 = Color3.fromRGB(170, 140, 210)
arrow.TextSize = 12
arrow.Parent = dropBtn

-- Dropdown List
local dropList = Instance.new("ScrollingFrame")
dropList.Name = "DropList"
dropList.Size = UDim2.new(1, 0, 0, 0)
dropList.Position = UDim2.new(0, 0, 0, 75)
dropList.BackgroundColor3 = Color3.fromRGB(25, 20, 35)
dropList.ScrollBarThickness = 4
dropList.ScrollBarImageColor3 = Color3.fromRGB(100, 70, 140)
dropList.BorderSizePixel = 0
dropList.Visible = false
dropList.Parent = fieldSection

local listUc = Instance.new("UICorner")
listUc.CornerRadius = UDim.new(0, 8)
listUc.Parent = dropList

local listLay = Instance.new("UIListLayout")
listLay.Padding = UDim.new(0, 2)
listLay.SortOrder = Enum.SortOrder.LayoutOrder
listLay.Parent = dropList

-- FEATURES SECTION (Right Column)
local rightColumn = Instance.new("Frame")
rightColumn.Name = "RightColumn"
rightColumn.Size = UDim2.new(0.48, 0, 0, 150)
rightColumn.Position = UDim2.new(0.52, 0, 0, 60)
rightColumn.BackgroundTransparency = 1
rightColumn.Parent = mainFrame

local featuresFrame = Instance.new("Frame")
featuresFrame.Name = "FeaturesFrame"
featuresFrame.Size = UDim2.new(1, 0, 0, 150)
featuresFrame.Position = UDim2.new(0, 0, 0, 0)
featuresFrame.BackgroundColor3 = Color3.fromRGB(25, 20, 35)
featuresFrame.Parent = rightColumn

local featuresUc = Instance.new("UICorner")
featuresUc.CornerRadius = UDim.new(0, 8)
featuresUc.Parent = featuresFrame

local featuresUs = Instance.new("UIStroke")
featuresUs.Color = Color3.fromRGB(100, 60, 140)
featuresUs.Thickness = 1
featuresUs.Parent = featuresFrame

local featuresTitle = Instance.new("TextLabel")
featuresTitle.Name = "FeaturesTitle"
featuresTitle.Size = UDim2.new(1, 0, 0, 30)
featuresTitle.Position = UDim2.new(0, 0, 0, 0)
featuresTitle.BackgroundTransparency = 1
featuresTitle.Font = Enum.Font.GothamBlack
featuresTitle.Text = "ACTIVE FEATURES"
featuresTitle.TextColor3 = Color3.fromRGB(220, 200, 240)
featuresTitle.TextSize = 14
featuresTitle.Parent = featuresFrame

local featuresList = Instance.new("Frame")
featuresList.Name = "FeaturesList"
featuresList.Size = UDim2.new(1, -10, 1, -35)
featuresList.Position = UDim2.new(0, 5, 0, 30)
featuresList.BackgroundTransparency = 1
featuresList.Parent = featuresFrame

local featuresLayout = Instance.new("UIListLayout")
featuresLayout.Padding = UDim.new(0, 2)
featuresLayout.SortOrder = Enum.SortOrder.LayoutOrder
featuresLayout.Parent = featuresList

-- MAIN START BUTTON (Right Side within Frame)
local mainStartBtn = Instance.new("TextButton")
mainStartBtn.Name = "MainStartBtn"
mainStartBtn.Size = UDim2.new(0.4, 0, 0, 40) -- Smaller size
mainStartBtn.Position = UDim2.new(0.55, 0, 1, -50) -- Moved to right side
mainStartBtn.BackgroundColor3 = Color3.fromRGB(90, 50, 140)
mainStartBtn.Font = Enum.Font.GothamBlack
mainStartBtn.Text = "START FARMING"
mainStartBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
mainStartBtn.TextSize = 16
mainStartBtn.Parent = mainFrame

local mainStartUc = Instance.new("UICorner")
mainStartUc.CornerRadius = UDim.new(0, 8)
mainStartUc.Parent = mainStartBtn

local mainStartUs = Instance.new("UIStroke")
mainStartUs.Color = Color3.fromRGB(150, 100, 190)
mainStartUs.Thickness = 2
mainStartUs.Parent = mainStartBtn

-- Populate Features (Limited to 4 to fit)
local features = {
    "âœ“ Anti-AFK System Active",
    "âœ“ Auto-Respawn Protection",
    "âœ“ Smart Auto-Convert",
    "âœ“ Field Teleportation"
}

for i, feature in pairs(features) do
    local featureItem = Instance.new("TextLabel")
    featureItem.Name = "Feature" .. i
    featureItem.Size = UDim2.new(1, 0, 0, 20)
    featureItem.BackgroundTransparency = 1
    featureItem.Font = Enum.Font.GothamSemibold
    featureItem.Text = feature
    featureItem.TextColor3 = Color3.fromRGB(180, 160, 210)
    featureItem.TextSize = 12
    featureItem.TextXAlignment = Enum.TextXAlignment.Left
    featureItem.LayoutOrder = i
    featureItem.Parent = featuresList
end

-- Populate Dropdown
for i, f in pairs(flowerFields) do
    local btn = Instance.new("TextButton")
    btn.Name = "FieldBtn" .. i
    btn.Size = UDim2.new(1, 0, 0, 30)
    btn.BackgroundColor3 = Color3.fromRGB(35, 30, 45)
    btn.AutoButtonColor = false
    btn.Font = Enum.Font.GothamMedium
    btn.Text = "  " .. f
    btn.TextColor3 = Color3.fromRGB(220, 220, 220)
    btn.TextSize = 12
    btn.TextXAlignment = Enum.TextXAlignment.Left
    btn.LayoutOrder = i
    btn.Parent = dropList

    local btnUc = Instance.new("UICorner")
    btnUc.CornerRadius = UDim.new(0, 6)
    btnUc.Parent = btn

    local btnUs = Instance.new("UIStroke")
    btnUs.Color = Color3.fromRGB(80, 60, 120)
    btnUs.Thickness = 1
    btnUs.Parent = btn

    btn.MouseButton1Click:Connect(function()
        autofarmField = f
        dropBtn.Text = f
        dropList.Visible = false
        dropList.Size = UDim2.new(1, 0, 0, 0)
        arrow.Text = "â–¼"
    end)

    btn.MouseEnter:Connect(function()
        btn.BackgroundColor3 = Color3.fromRGB(60, 40, 80)
        btnUs.Color = Color3.fromRGB(140, 100, 180)
    end)
    
    btn.MouseLeave:Connect(function()
        btn.BackgroundColor3 = Color3.fromRGB(35, 30, 45)
        btnUs.Color = Color3.fromRGB(80, 60, 120)
    end)
end

-- Update dropdown canvas size
local function updateDropListSize()
    dropList.CanvasSize = UDim2.new(0, 0, 0, #flowerFields * 32)
end
updateDropListSize()

-- Dropdown Toggle Logic
local dropdownOpen = false
dropBtn.MouseButton1Click:Connect(function()
    dropdownOpen = not dropdownOpen
    arrow.Text = dropdownOpen and "â–²" or "â–¼"
    arrow.Rotation = dropdownOpen and 180 or 0
    
    local targetHeight = dropdownOpen and math.min(#flowerFields * 32, 150) or 0
    dropList:TweenSize(UDim2.new(1, 0, 0, targetHeight), "Out", "Quad", 0.2, true)
    dropList.Visible = dropdownOpen
end)

-- MAIN START BUTTON EFFECTS & LOGIC
mainStartBtn.MouseEnter:Connect(function()
    mainStartBtn.BackgroundColor3 = Color3.fromRGB(110, 70, 160)
end)

mainStartBtn.MouseLeave:Connect(function()
    if mainStartBtn.Text == "START FARMING" then
        mainStartBtn.BackgroundColor3 = Color3.fromRGB(90, 50, 140)
    else
        mainStartBtn.BackgroundColor3 = Color3.fromRGB(140, 30, 90)
    end
end)

mainStartBtn.MouseButton1Click:Connect(function()
    if autofarmVar then
        autofarmVar = false
        autoTool = false
        mainStartBtn.Text = "START FARMING"
        mainStartBtn.BackgroundColor3 = Color3.fromRGB(90, 50, 140)
        statusValue.Text = "Stopped"
        statusValue.TextColor3 = Color3.fromRGB(220, 100, 100)
    else
        if autofarmField then
            task.spawn(farm)
            mainStartBtn.Text = "STOP FARMING"
            mainStartBtn.BackgroundColor3 = Color3.fromRGB(140, 30, 90)
            statusValue.Text = "Farming " .. autofarmField
            statusValue.TextColor3 = Color3.fromRGB(120, 220, 120)
        else
            statusValue.Text = "Select Field!"
            statusValue.TextColor3 = Color3.fromRGB(255, 200, 100)
        end
    end
end)

-- Sync status with button state
task.spawn(function()
    while task.wait(0.1) do
        if autofarmVar then
            if mainStartBtn.Text ~= "STOP FARMING" then
                mainStartBtn.Text = "STOP FARMING"
                mainStartBtn.BackgroundColor3 = Color3.fromRGB(140, 30, 90)
            end
        else
            if mainStartBtn.Text ~= "START FARMING" then
                mainStartBtn.Text = "START FARMING"
                mainStartBtn.BackgroundColor3 = Color3.fromRGB(90, 50, 140)
            end
        end
    end
end)

print("ðŸŽ‰ BSS Auto Farm - FULLY ORGANIZED UI LOADED!")
print("âœ… MAIN START BUTTON ACTIVE INSIDE FRAME")
print("âœ… Anti-AFK | Auto-Respawn | Auto-Convert: ALL ENABLED")
